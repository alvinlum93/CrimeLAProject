---
title: "Final Report"
author: "Group B"
date: "September 29, 2017"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
    df_print: tibble
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 10, fig.height = 7, fig.align = "center") 
```

```{r, include=FALSE}
crime_data<-read.csv("data/clean_data.csv")
```

\newpage

Introduction
=====================

Crime is always a hot topic in Los Angeles. With a considerably higher violent crime rate of 6.45 per 1000 residents in 2015, compared to US national median of 3.8 per 1000 residents (based on FBI crime data), L.A is amongst the most dangerous cities in US. According to Los Angeles Police Department(LAPD), from 2002 to 2012 the crime rate in city had declined in 10 consecutive years. However, in 2015, LAPD reported that for the first time in more than a decade, all categories of crime rose across the city (violent crime rose 20.2% and all crime was up 12.6% compared with 2014). The upward trend continued in 2016, with higher crime across four categories compared to 2015.Officials have pointed a range of factors that resulted in the jump, including more gang violence and a growth of homeless people.
With a high chance of 1 in 33 to become a victim of either violent or property crime in L.A, it is never too much to emphasize the importance of crime prevention and public safety. In order to find patterns of crime in L.A and come up with some useful suggestions accordingly in crime prevention, this paper looks into three main questions of various crime in L.A: who is more likely to be a victim; where is the accident-prone place in L.A and when the crime is most likely to occur. 
The dataset used in this paper contains information of crime occurred in L.A since 2010, with weekly update by City of Los Angeles. As this data is transcribed from original crime reports that are typed on paper and therefore there may be some inaccuracies within the data.

 


Context
-------------------
_Text here_

Theory
-------------------
_Text here_


Data Description
=====================

Text here


| Titre 1       |     Titre 2     |   Titre 3      |
| ------------- | -------------   | ---------      |
| Colonne       |     Colonne     |      Colonne   |
| Alignée à     |      Alignée au |     Alignée à  |
| Gauche        |      Centre     |      Droite    |


Demographic
=====================

_Text here_

Age and sex distribution
-------------------

```{r library, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(ggmap)
library(ggplot2)
library(dplyr)
library(lubridate)
library(tidyr)
library(stringr)
library(scales)

```

```{r , echo=FALSE}

##distribution of age among all victims
summary(crime_data$Victim.Age,na.rm=TRUE)
ggplot(crime_data,aes(x=Victim.Age,na.rm=TRUE))+geom_density()

#can choose either one below(haven't decided yet)
#plot option 1:
crime_data%>%filter(Victim.Sex=="F"|Victim.Sex=="M")%>%
ggplot(aes(x=Victim.Age,fill=Victim.Sex)) + geom_histogram(binwidth = 1,position="dodge")

```
The summary of the victim age shows the youngest victim is only 10 years old and the oldest being 99 years old.The mean age of victim is around 36 years old.From the density plot of victim age,we can see that there are two peak points at 
14 and 25 respectively.In addition,a histogram plot of the victim age of male and female is shown above.From the overlapping pattern,it is obvious that male are more likely to be a victim of crime at a young age(10-15 years old) or from 40 to 70 years old while female tend to be more in danger between around 15 to 35 years old,especially aged between 18 and 25.For example,at age 25,number of female victims are approximately 7500 higher than male victims.

```{r}
#summary of female age and male age respectively
female_age<-crime_data$Victim.Age[crime_data$Victim.Sex=="F"]
male_age<-crime_data$Victim.Age[crime_data$Victim.Sex=="M"]
summary(female_age,na.rm=TRUE)
summary(male_age,na.rm=TRUE)

```
_Hypothesis testing_
```{r , echo=FALSE}
# Code here
t.test(female_age,male_age,alternative = "two.sided")

```
_Text here_
From the summary of both male and female,the mean age of victim is lower for female(37.52 years old).We want to see whether this difference in mean age is due to random variation.A t-test is conducted to find out the results.Based on the t-test,we can conclude that there is strong evidence in rejecting the null hypothesis that the difference in means is 0.Thus,mean age of victim is significantly smaller for female.




Ethnicity
-------------------

```{r , echo=FALSE}
#average age of victims based on ethnicity and gender(Hispanic has the lowerst avg age)
avg_age<-crime_data%>%
  group_by(Victim.Descent.Global,Victim.Sex)%>%
  filter(!is.na(Victim.Age),!Victim.Descent.Global=="-",!Victim.Descent.Global=="",
         Victim.Sex=="F"|Victim.Sex=="M")%>%
  summarise(avg_age=mean(Victim.Age),count=n())%>%
  arrange(avg_age)

#option1:barchart of mean age between different Ethnicity
ggplot(avg_age,aes(x=Victim.Descent.Global,y=avg_age,fill=Victim.Sex))+geom_bar(stat = 'identity', position = 'dodge')+labs(x="race of victim",y="average age of victim")

#option2:boxplot of age between different Ethnicity
crime_data%>%
  filter(Victim.Sex=="F"|Victim.Sex=="M",!Victim.Descent.Global=="-",!Victim.Descent.Global=="")%>%
  ggplot(aes(x=Victim.Sex,y=Victim.Age,fill=Victim.Descent.Global))+geom_boxplot()
```
From the bar chart of average victim age based on ethnicity and gender,Hispanic have the lowest average age among all ethnicity groups and female Hispanic is the lowest(around 33 years old).For Blacks and Hispanic,female victim tends to be younger on average while it is not that obvious for other ethinicty groups.We want to carry out hypothesis testing to determine whether it is indeed the case according to the plot.

```{r}
#number of vitims with different gender and ethnicity
crime_data%>%
  filter(Victim.Sex=="F"|Victim.Sex=="M",!Victim.Descent.Global=="-",!Victim.Descent.Global=="")%>%
  ggplot(aes(x=Victim.Age,fill=Victim.Sex,  na.rm=TRUE)) + geom_bar()+facet_wrap(~Victim.Descent.Global)+
  labs(x="Victime Age",y="Number of victims")
```
From the above plot,it is obvious that Hispanic account for the largest part of victims and we would like to focus on Hispanic victims.


```{r}
#Thus focus on Hispanic
demographic <- crime_data %>% select(Victim.Age, Victim.Descent.Global, Victim.Sex) %>% 
 filter( !is.na(Victim.Age),!Victim.Descent.Global=="-",!Victim.Descent.Global=="",
         Victim.Sex=="F"|Victim.Sex=="M")%>%
  group_by(Victim.Age, Victim.Descent.Global, Victim.Sex) %>% 
  summarise(count = n())

Hispanic <- filter(demographic,  Victim.Descent.Global== "Hispanic")

ggplot(Hispanic, aes(x = Victim.Age, y = count, fill = as.factor(Victim.Sex))) + 
  geom_bar(stat = 'identity', position = 'dodge')    
```

_Text here_
We now have some clue in the most likely victim of a crime:Hispanic young female aged aroung 25 years old.
_Hypothesis testing_

```{r}
Hispanic_female1<-crime_data%>%filter(Victim.Descent.Global=="Hispanic")
Hispanic_female<-Hispanic_female1$Victim.Age[Hispanic_female1$Victim.Sex=="F"]
Hispanic_male1<-crime_data%>%filter(Victim.Descent.Global=="Hispanic")
Hispanic_male<-Hispanic_male1$Victim.Age[Hispanic_male1$Victim.Sex=="M"]
t.test(Hispanic_female,Hispanic_male,alternative = "two.sided")

black_female1<-crime_data%>%filter(Victim.Descent.Global=="Black")
black_female<-black_female1$Victim.Age[black_female1$Victim.Sex=="F"]
black_male1<-crime_data%>%filter(Victim.Descent.Global=="Black")
black_male<-black_male1$Victim.Age[black_male1$Victim.Sex=="M"]
t.test(black_female,black_male,alternative = "two.sided")

white_female1<-crime_data%>%filter(Victim.Descent.Global=="White")
white_female<-white_female1$Victim.Age[white_female1$Victim.Sex=="F"]
white_male1<-crime_data%>%filter(Victim.Descent.Global=="White")
white_male<-white_male1$Victim.Age[white_male1$Victim.Sex=="M"]
t.test(white_female,white_male,alternative = "two.sided")


```
From the t-tests above,female Hispanic victims are around 6 years younger on average than male Hispanic victims.For black people,female victims are around 3 years younger on average than male victims.However,as for white people,the average age is approximately the same(with a difference of between 0.02 to 0.25).

```{r , echo=FALSE}
# Code here
#
crime_data1<-filter(crime_data,!crime_data$Victim.Descent=="")
sum(crime_data1$Victim.Descent.Global=="White")/nrow(crime_data1)
sum(crime_data1$Victim.Descent.Global=="Black")/nrow(crime_data1)
sum(crime_data1$Victim.Descent.Global=="Hispanic")/nrow(crime_data1)

```
We did a proportion comparison with real population data.According to the population of LA,white people was 49.8% while black people was 9.6% of the population.While in the crime data,white people was 27.4% and black people was 17.8%.Thus,there are huge difference between the population proportion with the crime proportion. 




Correlation between type of crime and age/sex/ethnicity (PLOT + hypothesis Testing !)
-------------------


relationship with type of crime
-------------------
```{r , echo=FALSE}
#type of crime with gender
type<-crime_data%>%select(crime_type,Victim.Sex,Victim.Age)%>%
  filter(!is.na(Victim.Age), Victim.Sex=="F"|Victim.Sex=="M")%>%
  group_by(crime_type,Victim.Sex)%>%
summarise(count=n())%>%
  arrange(desc(count))
ggplot(type, aes(x =crime_type , y= count,fill=Victim.Sex)) + geom_bar(position = position_dodge(),stat = 'identity')  +
  theme(axis.text = element_text(angle= 45, hjust = 1))+labs(x="crime type",y="number of victims")+scale_y_continuous(breaks=c(10000,20000,40000,80000,100000,200000,300000))
```
From the barplot on crime type above,burglary,battery,assault and vandalism are the most likely crime types.Burglary and assault tends to be aiming more on male while battery and other sexual offences have more female victims.

```{r}
#boxplot of victim age between different type of crimes and gender
crime_data%>%
  filter(Victim.Sex=="F"|Victim.Sex=="M",!Victim.Descent.Global=="-",!Victim.Descent.Global=="")%>%
  group_by(crime_type,Victim.Sex)%>%
  
  ggplot(aes(x=Victim.Sex,y=Victim.Age,fill=crime_type))+geom_boxplot()

```


Area distribution
=====================

_Text here_

number of crimes in different areas per sex
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Area distrubution per type of crime 
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_
Correlation between area and type of crime (hypothesis testing)

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Premise of a crime scene per sex
-------------------


for the main areas with highest crime rate - what are the main types of crime


Time
=====================

_Text here_

Day Time according to type of crime
-------------------

(ex : fraud in the day, rape a night, burglary during the day etc...)

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Day Time according to sex
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Correlation between time reported - time occured and type of crime
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Correlation between time reported - time occured and case solved or not for a specific month
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```


Public holidays impact
-------------------

Effect of Public Holidays on crime Occurrence and Type.
```{r}

#Exploratory plot
ggplot(crime_data,aes(x=Date.Occurred.C,color=public_holiday))+geom_bar()+scale_color_manual(values=c("red","blue"))

crime_data%>%
  group_by(public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(desc(average.crime.per.day))


crime_data%>%
  filter(Day.Occurred=="01" & Month.Occurred=="01") %>%
  group_by(Date.Occurred.C) %>%
  summarise(count=n())
    
crime_data%>%
  group_by(Jan1=ifelse(Day.Occurred=="01" & Month.Occurred=="01",TRUE,FALSE))%>%
  summarise(Average.Report.Time=mean(Time.Between.Occured.Reported)) %>%
  arrange(desc(Average.Report.Time))


crime_data%>%
  filter(Day.Occurred!="01" & Month.Occurred!="01")%>%
  summarise(Occured.Reported.Gap.SD=sd(Time.Between.Occured.Reported))

```

Findings from the exploratory plot and tables:
i.) The mean of # of crime in LA is higher on public holidays, but
ii.) The number of crime is significantly higher on 1st of Jan in every year, and
iii.) The length between occured time and reporting time tend to be longer on 1st Jan in every year;


I cannot find information regarding this on the dataLA website, but it looks like they have coded crime incidents occured on other days as 1st Jan for some conditions.
So should we exclude cases with reporting time lag for say i.)365 days/ ii. 15 days (which is the average)?


As nature of Sundays is similar to holidays, I will include all Sundays as 'public holidays and Sundays' as the next step.




```{R}
#exclude lagged for more than 15 days (15 or 15+71 (1SD) or 15 + 141 (2SD?)

crime_data$Jan1.exclude.15 <- crime_data$Day.Occurred=="01" & crime_data$Month.Occurred=="01" & crime_data$Time.Between.Occured.Reported>15


crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(desc(public_holiday))

#by crime type
crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(crime_type,public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(crime_type,public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(crime_type,desc(public_holiday))

```


Included Sundays and exclude crime occured on 1st Jan and have a time gap between occured and report >15 days

```{R}


crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(Sundays_public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(Sundays_public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(desc(Sundays_public_holiday))

#by crime type
crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(crime_type,Sundays_public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(crime_type,Sundays_public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(crime_type,desc(Sundays_public_holiday))

```


```{r}
#two sample t-test - is there a difference between # of crime on public holidays/Sundays vs other days?

Regular_day_crime <- crime_data%>%filter(Sundays_public_holiday==FALSE & Jan1.exclude.15==FALSE)%>%select(Date.Occurred.C)%>%
  group_by(Date.Occurred.C)%>%summarise(count=n())

Holiday_crime <- crime_data%>%filter(Sundays_public_holiday==TRUE & Jan1.exclude.15==FALSE)%>%select(Date.Occurred.C)%>%
  group_by(Date.Occurred.C)%>%summarise(count=n())

mean(Regular_day_crime$count); mean(Holiday_crime$count)

t.test(Regular_day_crime$count,Holiday_crime$count,alternative = "greater")

```


Result shows that the average number of crime on holidays and Sundays is lower than that in regular days in 95% significance level.


```{r}
#By crime type (Chi-sq-test?)
crime_data_excluded_1Jan_15 <- crime_data%>%filter(Jan1.exclude.15==FALSE) %>% select(crime_type,Sundays_public_holiday,Date.Occurred.C) %>% group_by(crime_type,Sundays_public_holiday,Date.Occurred.C) %>% summarise (countperday=n()) %>% ungroup() %>% group_by(crime_type,Sundays_public_holiday) %>% summarise (average_per_day=mean(countperday))

crime_data_excluded_1Jan_15

PH_Crimetype_tbl <- xtabs(average_per_day~crime_type+Sundays_public_holiday,crime_data_excluded_1Jan_15)
PH_Crimetype_tbl

# Most of crime type has less ocuuring rate on public holidays, but it likes look assault, battery, gunshots, rape and vandalism has a higher occuring rate in public holidays.

```



Prediction and logistic regression
=====================



Discussion
=====================

What results did you find?	
-------------------

Why is this interesting?
-------------------

Help LA police, predict the crime, prevention for the potential victims

What would be the next steps?	
-------------------




