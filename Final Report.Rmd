---
title: "Final Report"
author: "Group B"
date: "September 29, 2017"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
    df_print: tibble
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 10, fig.height = 7, fig.align = "center") 
```

```{r, include=FALSE}
crime_data<-read.csv("data/clean_data.csv")
```

\newpage

Introduction
=====================

Crime is always a hot topic in Los Angeles. With a considerably higher violent crime rate of 6.45 per 1000 residents in 2015, compared to US national median of 3.8 per 1000 residents (based on FBI crime data), L.A is amongst the most dangerous cities in US. According to Los Angeles Police Department(LAPD), from 2002 to 2012 the crime rate in city had declined in 10 consecutive years. However, in 2015, LAPD reported that for the first time in more than a decade, all categories of crime rose across the city (violent crime rose 20.2% and all crime was up 12.6% compared with 2014). The upward trend continued in 2016, with higher crime across four categories compared to 2015.Officials have pointed a range of factors that resulted in the jump, including more gang violence and a growth of homeless people. With a high chance of 1 in 33 to become a victim of either violent or property crime in L.A, it is never too much to emphasize the importance of crime prevention and public safety. In order to find patterns of crime in L.A and come up with some useful suggestions accordingly in crime prevention, this paper looks into three main questions of various crime in L.A: who is more likely to be a victim; where is the accident-prone place in L.A and when the crime is most likely to occur. The dataset used in this paper contains information of crime occurred in L.A since 2010, with weekly update by City of Los Angeles. As this data is transcribed from original crime reports that are typed on paper and therefore there may be some inaccuracies within the data.

Context
-------------------
_Text here_

Theory
-------------------
_Text here_


Data Description
=====================

The dataset contains information on crime incidents in Los Angeles. The source description (LAPD) states that the dataset may have some inaccuracies due to information being transferred from original crime statements that are typed on paper. As crime data contains sensitive personal information, fields that contain address information are only provided to the nearest hundred block. The dataset includes crime data from 2010 through September 2017.

Two separate csv files are provided with  Crime_Data_2010_2017  containing the main data and MO_Codes containing the description of MO codes that are included in the crime data for classification. 
The dataset is made up of 1.584.316 observations and 26 variables. To structure the variables, we split them into four groups: demographic, geographic, crime and time type variables. Demographic category consists of the victims age, sex and descent. The type of variables and a detailed description can be found in the table below: 

:Demographics

| Variable      |    Type     |   Description      |
| ------------- | ----------- | :---------------------------------------------------      |
| Victim.Age    |     dbl     |      Two character numeric   |
| Victim.Sex    |    fctr     |     F - Female M - Male X - Unknown  |
|Victim.Descent |    fctr     |      Descent Code: A - Other Asian B - Black C - Chinese D - Cambodian F - Filipino G - Guamanian H - Hispanic/Latin/Mexican I - American Indian/Alaskan Native J - Japanese K - Korean L - Laotian O - Other P - Pacific Islander S - Samoan U - Hawaiian V - Vietnamese W - White X - Unknown Z - Asian Indian    |



The geographical category contains variables relating to the geographical occurrence of crime and reporting of crimes. Variables include the area ID, the name of the area, the district reporting the crime, the premise code, a premise description, the address, the cross street of rounded address and the location where the crime occurred. The type of variables and a detailed description can be found in the table below: 

:Geographic

| Variable            |    Type     |   Description      |
| -------------       | ------------- | :-------------------------------------------------      |
| Area.ID             |  int    |  The LAPD has 21 Community Police Stations referred to as Geographic Areas within the department. These Geographic Areas are sequentially numbered from 1-21. |
| Area.Name           |  fctr    |   The 21 Geographic Areas or Patrol Divisions are also given a name designation that references a landmark or the surrounding community that it is responsible for. For example 77th Street Division is located at the intersection of South Broadway and 77th Street, serving neighborhoods in South Los Angeles.   |
| Reporting.District  |   int   |  A four-digit code that represents a sub-area within a Geographic Area. All crime records reference the "RD" that it occurred in for statistical comparisons.    |
| Premise.Code        | dbl     |  The type of structure, vehicle, or location where the crime took place.    |
| Premise.Description | fctr     |  Defines the Premise Code provided    |
| Address             |   fctr   |  Street address of crime incident rounded to the nearest hundred block to maintain anonymity.    |
| Cross.Street  |  fctr   | Cross Street of rounded Address.  |
| Location      |   fctr   |   The location where the crime incident occurred. Actual address is omitted for confidentiality. XY coordinates reflect the nearest 100 block.   |
             

The crime category contains all variables that describe the incidents of crime in more detail such as the type of crime, the weapons used or the current status of the crime. The variables we assorted to this category include the number of the crime on record, the weapons used and their description, the status of the crime (code and description), then crime codes and their description as well as the modus operandi associated with the suspect in commission of the crime.

:Crime

| Variable       |    Type     |   Description      |
| ------------- | -------------   | :------------------------------------------------------------------------      |
|  DR.Number        |      int   |    Division of Records Number: Official file number made up of a 2 digit year, area ID, and 5 digits       |
|  Weapon.Used.Code |     dbl    |   The type of weapon used in the crime.        |
|  Weapon.Description|  fctr     |    Defines the Weapon Used Code provided.       |
|  Status.Code      |   fctr     |    Status of the case. (IC is the default)       |
|  Status.Description|    fctr   |   Defines the Status Code provided.        |
|  Crime.Code.1     |    fctr    |    Indicates the crime committed. Crime Code 1 is the primary and most serious one. Crime Code 2, 3, and 4 are respectively less serious offenses. Lower crime class numbers are more serious.      |
|  Crime.Code.2     |    fctr    |  May contain a code for an additional crime, less serious than Crime Code 1.      |
|  Crime.Code.3     |    fctr    |    May contain a code for an additional crime, less serious than Crime Code 1.       |
|  Crime.Code.4     |    fctr    | May contain a code for an additional crime, less serious than Crime Code 1.          |
|  Crime.Code       |    int     |     Indicates the crime committed. (Same as Crime Code 1)      |
|  Crime.Code.Description|  fctr |   Defines the Crime Code provided.        |
|  MO.Codes         |   fctr     |     Modus Operandi: Activities associated with the suspect in commission of the crime.       |



The final category groups all variables related to time. It contains a variable that contains the reported date, the date and time occurrence.

:Time

| Variable      |    Type         |   Description  |
| ------------- | -------------   | :------------------------     |
| Date.Reported |     fctr     |   MM/DD/YYYY   |
| Date.Occurred |    fctr    |   MM/DD/YYYY   |
| Time.Occurred |      int     |    In 24 hour military time.   |



Data Cleaning Description
-------------------
As the data is provided in two different csv files. The first step that we took was to merge the crime_data and code_data into one single dataset. Then we looked at the date columns (date occured and date reported) and reformated each date to three new columns. Thus creating a new colum for the day occured, month occured and year occured as well as day reported, month reported and year reported. 
For the completeness of full information on every year, we have omitted data from the year 2017 and will focus on the data from 2010 to 2016 included. 

In order to make an interesting analysis we wanted to work with the information on victim descent. The abbreviations for victim descent in the original dataset, however, made analysis a little impractical as they weren't intuitively understandable (e.g. "D" standing for "Cambodian"). This is why we labeled the descent variables with the full description. (e.g. "W" being "White" and "D" being "Cambodian"). This led to ddd categories of descent: 

:Victim Descent

| Victim Descent Original  |   Victim Descent New  |
| ------------- | :------------------------     |
| H  |     Hispanic     | 
| W  |   White       | 
| B  |    Black      | 
| O  |   Other       | 
| A  |   Other Asian       | 
| C  |     Chinese     | 
| ' '  |          | 
| X  |    Unknown      | 
| F  |    Filipino      | 
| U  |   Hawaiian       | 
| K  |    Korean      | 
| P  |   Pacific Islander       | 
| G  |    Guamanian      | 
| J  |   Japanese       | 
| I  |    American Indian/Alaskan Native      | 
| V  |   Vietnamese       | 
| Z  |    Asian Indian      | 
| S  |    Samoan      | 
| D  |    Cambodian      | 
| L  |    Laotian      | 
| -  |    -      | 

As there were some very specific subcategories for America (such as Alaskan Native)  we also added an additional more global colum on victim descent to be able to work with both the more detailed descent information and the more global descent variables. We reduced the global descent column to contain six groups(White, Black, Hispanic, Other, Asian and Pacific.  

In order to simplify the mapping of location information, we also extracted longitude and latitude from the location column and created additional, separate columns for longitude and latitude. 

The data covers the 21 different areas of Los Angeles and categorizes 135 different types of crimes.
--> renamed crime variables 



Demographic
=====================

_Firstly,we want to find out what kind of people are more likely to be a victim of crime and thus look at some demographic variables such as age,sex and ethnicity._

Age and sex distribution
-------------------

```{r library, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(ggmap)
library(ggplot2)
library(dplyr)
library(lubridate)
library(tidyr)
library(stringr)
library(scales)

```

Here we begin with a summary of the age among all victims.The summary of the victim age shows the youngest victim is only 10 years old and the oldest being 99 years old. The mean age of victim is around 36 years old. 
```{r , echo=FALSE}

##distribution of age among all victims
summary(crime_data$Victim.Age,na.rm=TRUE)
```

Typically the age pattern of victims between male and female are not the same.We then construct a summary for male and female respectively and a histogram plot to see if it is the case.

```{r}
#summary of female age and male age respectively
female_age<-crime_data$Victim.Age[crime_data$Victim.Sex=="F"]
male_age<-crime_data$Victim.Age[crime_data$Victim.Sex=="M"]
summary(female_age,na.rm=TRUE)
summary(male_age,na.rm=TRUE)
#plot
crime_data%>%filter(Victim.Sex=="F"|Victim.Sex=="M")%>%
ggplot(aes(x=Victim.Age,fill=Victim.Sex)) + geom_histogram(binwidth = 1,position="dodge")

```

The minimum and maximum of victim age are the same for both sex. However,the female victim age is smaller(37.52 years old) on average than for male(38.72 years old).
From the overlapping pattern of the histogram plot above, it is obvious that male are more likely to be a victim of crime at a young age(10-15 years old) or from 40 to 70 years old while female tend to be more in danger between around 15 to 35 years old, especially aged between 18 and 25. For example, at age 25,number of female victims are approximately 7500 higher than male victims.


_Hypothesis testing_

As we have seen a different pattern in the victim age for male and female above, we want to use student t-test to check if the difference exists statistcally or is due to random variation. 

```{r , echo=FALSE}
# Code here
t.test(female_age,male_age,alternative = "two.sided")

```

A t-test is conducted build on the null hypothesis that there is no significant difference in the mean victim age between male and female.Based on the t-test,a p-value of less than 2.2e-16 is really low and we can conclude that there is strong evidence in rejecting the null hypothesis that the difference in means is 0.Thus,mean age of victim is significantly smaller for female.


Ethnicity
-------------------

Now that we have some clue about the relationship between age and gender,we want to dig more by adding another ethnicity variable.Below is a boxplot of victim age of male and female based on different ethnicity.

```{r , echo=FALSE}
#average age of victims based on ethnicity and gender(Hispanic has the lowerst avg age)
avg_age<-crime_data%>%
  group_by(Victim.Descent.Global,Victim.Sex)%>%
  filter(!is.na(Victim.Age),!Victim.Descent.Global=="-",!Victim.Descent.Global=="",
         Victim.Sex=="F"|Victim.Sex=="M")%>%
  summarise(avg_age=mean(Victim.Age),count=n())%>%
  arrange(avg_age)

#option1:barchart of mean age between different Ethnicity
#ggplot(avg_age,aes(x=Victim.Descent.Global,y=avg_age,fill=Victim.Sex))+geom_bar(stat = 'identity', position = 'dodge')+labs(x="race of victim",y="average age of victim")

#option2:boxplot of age between different Ethnicity(chosen)
crime_data%>%
  filter(Victim.Sex=="F"|Victim.Sex=="M",!Victim.Descent.Global=="-",!Victim.Descent.Global=="")%>%
  ggplot(aes(x=Victim.Sex,y=Victim.Age,fill=Victim.Descent.Global))+geom_boxplot()
```
From the boxplot based on ethnicity and gender,Hispanic have the lowest median age among all ethnicity groups and female Hispanic is the lowest(around 33 years old).For Blacks and Hispanic,female victim tends to be younger while it is not that obvious for other ethinicty groups.

We also have a histogram plot of victims counts with different gender and ethnicity below.

```{r}
#number of vitims with different gender and ethnicity
crime_data%>%
  filter(Victim.Sex=="F"|Victim.Sex=="M",!Victim.Descent.Global=="-",!Victim.Descent.Global=="")%>%
  ggplot(aes(x=Victim.Age,fill=Victim.Sex,  na.rm=TRUE)) + geom_bar(position="dodge")+facet_wrap(~Victim.Descent.Global)+
  labs(x="Victime Age",y="Number of victims")
```
From the above plot,it is obvious that Hispanic account for the largest part of victims,followed by black and white victims. Also,there are observable difference in the age distribution between male and female for the three ethnicity group.Focus on hispanic victims,female aged below around 40 are much more likely to be a victim than male.
```{r}
#Thus focus on Hispanic
#demographic <- crime_data %>% select(Victim.Age, Victim.Descent.Global, Victim.Sex) %>% 
# filter( !is.na(Victim.Age),!Victim.Descent.Global=="-",!Victim.Descent.Global=="",
#         Victim.Sex=="F"|Victim.Sex=="M")%>%
#  group_by(Victim.Age, Victim.Descent.Global, Victim.Sex) %>% 
#  summarise(count = n())

#Hispanic <- filter(demographic,  Victim.Descent.Global== "Hispanic")

#ggplot(Hispanic, aes(x = Victim.Age, y = count, fill = as.factor(Victim.Sex))) + 
#  geom_bar(stat = 'identity', position = 'dodge')    
```


_Hypothesis testing_
We want to carry out hypothesis testing to determine whether it is indeed the case according to the plot.
```{r}
Hispanic_female1<-crime_data%>%filter(Victim.Descent.Global=="Hispanic")
Hispanic_female<-Hispanic_female1$Victim.Age[Hispanic_female1$Victim.Sex=="F"]
Hispanic_male1<-crime_data%>%filter(Victim.Descent.Global=="Hispanic")
Hispanic_male<-Hispanic_male1$Victim.Age[Hispanic_male1$Victim.Sex=="M"]
t.test(Hispanic_female,Hispanic_male,alternative = "two.sided")

black_female1<-crime_data%>%filter(Victim.Descent.Global=="Black")
black_female<-black_female1$Victim.Age[black_female1$Victim.Sex=="F"]
black_male1<-crime_data%>%filter(Victim.Descent.Global=="Black")
black_male<-black_male1$Victim.Age[black_male1$Victim.Sex=="M"]
t.test(black_female,black_male,alternative = "two.sided")

white_female1<-crime_data%>%filter(Victim.Descent.Global=="White")
white_female<-white_female1$Victim.Age[white_female1$Victim.Sex=="F"]
white_male1<-crime_data%>%filter(Victim.Descent.Global=="White")
white_male<-white_male1$Victim.Age[white_male1$Victim.Sex=="M"]
t.test(white_female,white_male,alternative = "two.sided")


```
In the t-tests above,all three p-values are smaller than 0.05 which means that the difference in mean age is significant for all three ethnicity groups.Female Hispanic victims are around 6 years younger on average than male Hispanic victims.For black people,female victims are around 3 years younger on average than male victims.However,as for white people,the average age is approximately the same(with a difference of between 0.02 to 0.25).

Also,we want to know if the proportion of crime victims based on different ethnicity are the same as in the real population.Therefore,we calculate the proportion of white,black,hispanic victims below.
```{r , echo=FALSE}
crime_data1<-filter(crime_data,!crime_data$Victim.Descent=="")
sum(crime_data1$Victim.Descent.Global=="White")/nrow(crime_data1)
sum(crime_data1$Victim.Descent.Global=="Black")/nrow(crime_data1)
sum(crime_data1$Victim.Descent.Global=="Hispanic")/nrow(crime_data1)

```
According to the population of LA, non-Hispanic white people was 28.7% while black people was 9.6% of the population. While in the crime data,white people was 27.4% and black people was 17.8%.Thus,there are huge difference between the population proportion with the crime proportion for black people.



We can see that the variables we discussed above are correlated with each other from the plots,now we construct a chi-squared test to verify the dependence shown in the plots.
```{r}
chisq.test(crime_data$Victim.Descent,crime_data$Victim.Age)
chisq.test(crime_data$Victim.Descent,crime_data$Victim.Sex)
chisq.test(crime_data$Victim.Age,crime_data$Victim.Sex)

```
From the chi-squared tests above,it is obvious that there are certain degree of dependence between age and sex,age and ethnicity,sex and ethnicity.

_summary_

From the demographic analysis carried out so far,we found that people with certain demographic characteristics are more likely to be a victim of crime. For example,Hispanic young female aged aroung 25 years old are more likely to become crime victim.




relationship with type of crime
-------------------
As we now have some understanding on the victim information,we want to find out whether the characteristics of victims  differs in different types of crime.
```{r , echo=FALSE}
#type of crime with gender
type<-crime_data%>%select(crime_type,Victim.Sex,Victim.Age)%>%
  filter(!is.na(Victim.Age), Victim.Sex=="F"|Victim.Sex=="M")%>%
  group_by(crime_type,Victim.Sex)%>%
summarise(count=n())%>%
  arrange(desc(count))
ggplot(type, aes(x =crime_type , y= count,fill=Victim.Sex)) + geom_bar(position = position_dodge(),stat = 'identity')  +
  theme(axis.text = element_text(angle= 45, hjust = 1))+labs(x="crime type",y="number of victims")+scale_y_continuous(breaks=c(10000,20000,40000,80000,100000,200000,300000))
```
From the barplot on crime type above,burglary,battery,assault and vandalism are the most likely crime types.Burglary and assault tends to be aiming more on male while battery and other sexual offences have more female victims.

```{r}
#boxplot of victim age between different type of crimes and gender
crime_data%>%
  filter(Victim.Sex=="F"|Victim.Sex=="M",!Victim.Descent.Global=="-",!Victim.Descent.Global=="")%>%
  group_by(crime_type,Victim.Sex)%>%
  
  ggplot(aes(x=Victim.Sex,y=Victim.Age,fill=crime_type))+geom_boxplot()

```




Area distribution
=====================

We have seen who are the victims of the crime, now let's focus on the location of these crimes. Of course, we can make the hypothesis that the location depends on the type of crime and on the victim.

number of crimes in different areas
-------------------

First, we want to study the distribution of crime in the different areas.

```{r , echo=FALSE}
top5_crime <-  crime_data %>% select(Area.Name, crime_type) %>% group_by(crime_type, Area.Name) %>% summarise(count = n()) %>% top_n(5, wt =  count) 
top5_crime

ggplot(crime_data, aes(x = crime_type)) + geom_bar() + facet_wrap(~ Area.Name) + theme(axis.text = element_text(angle= 60, hjust = 1))
```

From these graphs, we can see that the distribution of the type of crime is slightly similar in the different areas. 

_Hypothesis testing_

Let's conduct a X-squared test to test the hypothesis whether the crime area is independent of the type of a crime at .05 significance level.

```{r}
tbl = table(crime_data$Area.Name, crime_data$crime_type) 
chisq.test(tbl)
```

As the p-value is lower than the .05 significance level, we reject the null hypothesis that the crime area is independent of the type of a crime.

Hence, let's delve deeper into the analysis to see the correlation between these two variables.



Let's study more specificaly the distribution of crime between 77th Street and SouthWest.

```{r}

crime_data_77_SW <- crime_data %>% select(Area.Name, crime_type) %>% filter(Area.Name == 'Topanga' | Area.Name == 'Hollenbeck')
crime_data_77_SW$Area.Name <- sapply(crime_data_77_SW$Area.Name, as.character)
crime_data_77_SW$crime_type <- sapply(crime_data_77_SW$crime_type, as.character)
test <- chisq.test(table(crime_data_77_SW$Area.Name, crime_data_77_SW$crime_type))
table(crime_data_77_SW$Area.Name, crime_data_77_SW$crime_type)
test
```



Another way to address the problem is to look at the crime density for different type of crime in Los Angeles.


Area distrubution per type of crime 
-------------------

```{r, fig.width=7, fig.height=10}

crime_data_coord <- crime_data %>% select(longitude, lattitude, Year.Occurred, crime_type) %>% filter(Year.Occurred == 2016)


LAMap <- ggmap(
  get_map("Los Angeles", zoom = 11), extent = "device", 
  legend = "topright")

LAMap +
  stat_density2d(aes(x = longitude, y = lattitude, fill = ..level.., 
                     alpha = ..level..),
    size = 2, bins = 4, data = crime_data_coord, geom = "polygon", na.rm = TRUE) +
  scale_fill_gradient("Crime\nDensity") +
  scale_alpha(range = c(.4, .8), guide = FALSE) +
  guides(fill = guide_colorbar(barwidth = 1, barheight = 6)) + facet_wrap( ~ crime_type)
```


Premise of a crime scene per sex
-------------------


for the main areas with highest crime rate - what are the main types of crime


Time
=====================

_Text here_

Day Time according to type of crime
-------------------

(ex : fraud in the day, rape a night, burglary during the day etc...)

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Day Time according to sex
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Correlation between time reported - time occured and type of crime
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```

Correlation between time reported - time occured and case solved or not for a specific month
-------------------

```{r , echo=FALSE}
# Code here
```

_Text here_

_Hypothesis testing_

```{r , echo=FALSE}
# Code here
```


Public holidays impact
-------------------

Effect of Public Holidays on crime Occurrence and Type.
```{r}

#Exploratory plot
ggplot(crime_data,aes(x=Date.Occurred.C,color=public_holiday))+geom_bar()+scale_color_manual(values=c("red","blue"))

crime_data%>%
  group_by(public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(desc(average.crime.per.day))


crime_data%>%
  filter(Day.Occurred=="01" & Month.Occurred=="01") %>%
  group_by(Date.Occurred.C) %>%
  summarise(count=n())
    
crime_data%>%
  group_by(Jan1=ifelse(Day.Occurred=="01" & Month.Occurred=="01",TRUE,FALSE))%>%
  summarise(Average.Report.Time=mean(Time.Between.Occured.Reported)) %>%
  arrange(desc(Average.Report.Time))


crime_data%>%
  filter(Day.Occurred!="01" & Month.Occurred!="01")%>%
  summarise(Occured.Reported.Gap.SD=sd(Time.Between.Occured.Reported))

```

Findings from the exploratory plot and tables:
i.) The mean of # of crime in LA is higher on public holidays, but
ii.) The number of crime is significantly higher on 1st of Jan in every year, and
iii.) The length between occured time and reporting time tend to be longer on 1st Jan in every year;


I cannot find information regarding this on the dataLA website, but it looks like they have coded crime incidents occured on other days as 1st Jan for some conditions.
So should we exclude cases with reporting time lag for say i.)365 days/ ii. 15 days (which is the average)?


As nature of Sundays is similar to holidays, I will include all Sundays as 'public holidays and Sundays' as the next step.




```{R}
#exclude lagged for more than 15 days (15 or 15+71 (1SD) or 15 + 141 (2SD?)

crime_data$Jan1.exclude.15 <- crime_data$Day.Occurred=="01" & crime_data$Month.Occurred=="01" & crime_data$Time.Between.Occured.Reported>15


crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(desc(public_holiday))

#by crime type
crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(crime_type,public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(crime_type,public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(crime_type,desc(public_holiday))

```


Included Sundays and exclude crime occured on 1st Jan and have a time gap between occured and report >15 days

```{R}


crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(Sundays_public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(Sundays_public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(desc(Sundays_public_holiday))

#by crime type
crime_data%>%
  filter(Jan1.exclude.15==FALSE)%>%
  group_by(crime_type,Sundays_public_holiday,Date.Occurred.C)%>%
  summarise(count=n()) %>%
  group_by(crime_type,Sundays_public_holiday) %>%
  summarise(average.crime.per.day=mean(count)) %>%
  arrange(crime_type,desc(Sundays_public_holiday))

```


```{r}
#two sample t-test - is there a difference between # of crime on public holidays/Sundays vs other days?

Regular_day_crime <- crime_data%>%filter(Sundays_public_holiday==FALSE & Jan1.exclude.15==FALSE)%>%select(Date.Occurred.C)%>%
  group_by(Date.Occurred.C)%>%summarise(count=n())

Holiday_crime <- crime_data%>%filter(Sundays_public_holiday==TRUE & Jan1.exclude.15==FALSE)%>%select(Date.Occurred.C)%>%
  group_by(Date.Occurred.C)%>%summarise(count=n())

mean(Regular_day_crime$count); mean(Holiday_crime$count)

t.test(Regular_day_crime$count,Holiday_crime$count,alternative = "greater")

```


Result shows that the average number of crime on holidays and Sundays is lower than that in regular days in 95% significance level.


```{r}
#By crime type (Chi-sq-test?)
crime_data_excluded_1Jan_15 <- crime_data%>%filter(Jan1.exclude.15==FALSE) %>% select(crime_type,Sundays_public_holiday,Date.Occurred.C) %>% group_by(crime_type,Sundays_public_holiday,Date.Occurred.C) %>% summarise (countperday=n()) %>% ungroup() %>% group_by(crime_type,Sundays_public_holiday) %>% summarise (average_per_day=mean(countperday))

crime_data_excluded_1Jan_15

PH_Crimetype_tbl <- xtabs(average_per_day~crime_type+Sundays_public_holiday,crime_data_excluded_1Jan_15)
PH_Crimetype_tbl
```

Most of crime type has less ocuuring rate on public holidays, but it likes look assault, battery, gunshots, rape and vandalism has a higher occuring rate in public holidays.


Prediction and logistic regression
=====================

_Data Cleaning_

```{r}
# Remove missing values for victim age and premise code
crime_data[, "Victim.Sex"] <- sapply(crime_data[, "Victim.Sex"], as.character)
crime_data_NA <- crime_data[!is.na(crime_data$Victim.Age) & !is.na(crime_data$Premise.Code) & (crime_data$Victim.Sex == "F" | crime_data$Victim.Sex == "M"),]
crime_data[, "Victim.Sex"] <- sapply(crime_data[, "Victim.Sex"], as.factor)

```

_Training set and learning set_

```{r}
train_data <- crime_data_NA[crime_data_NA$Year.Occurred != 2016, ]
test_data <- crime_data_NA[crime_data_NA$Year.Occurred == 2016, ]
```

_Predict the type of crime_

First, we try to predict the type of crime according to different parameters such as the age of the potential victim, the sex, the ethnicity and the area

```{r}
#Multinomial Logistic Regression

library("nnet")
library(pscl)

model <- multinom(Area.Name ~ Victim.Age + Victim.Sex + Victim.Descent +  crime_type, data = test_data)

summary <- summary(model)

pR2(model)

test_data_predict <- test_data %>% select(Victim.Age, Victim.Sex, crime_type)
predict_area <- predict(model, test_data_predict, type = 'class')

sum(test_data$Area.Name == predict_area)/length(predict_area)

```


Discussion
=====================

What results did you find?	
-------------------

Why is this interesting?
-------------------

Help LA police, predict the crime, prevention for the potential victims

What would be the next steps?	
-------------------




